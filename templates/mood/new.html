{% extends "base.html" %}

{% block title %}New Mood Entry - AI Powered Mental Health and Personalized Recommendation System{% endblock %}

{% block content %}
<div class="main-content">
    <!-- Header Section -->
    <div class="text-center mb-5">
        <h1 class="h2 text-dark mb-2">
            <i class="fas fa-heart text-primary me-2"></i>Track Your Mood
        </h1>
        <p class="text-muted">How are you feeling today? Let's capture your emotional state and understand what's influencing it.</p>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-8">
            <form id="moodForm" class="card shadow-lg border-0">
                <div class="card-body p-4 p-lg-5">
                    
                    <!-- Mood Score Section -->
                    <div class="mb-5">
                        <h5 class="card-title mb-3">
                            <i class="fas fa-smile me-2 text-warning"></i>How are you feeling right now?
                        </h5>
                        <div class="text-center mb-4">
                            <div class="mood-display mb-3">
                                <div id="moodEmoji" class="display-1 mb-2">üòê</div>
                                <div id="moodLabel" class="h4 text-muted">Neutral</div>
                                <div id="moodScore" class="h2 text-primary">5/10</div>
                            </div>
                        </div>
                        <div class="mood-slider-container">
                            <input type="range" id="mood_score" name="mood_score" min="1" max="10" value="5" 
                                   class="form-range mood-slider" step="1">
                            <div class="d-flex justify-content-between mt-2">
                                <span class="text-danger small">üò¢ Very Low</span>
                                <span class="text-warning small">üòê Neutral</span>
                                <span class="text-success small">üòä Very High</span>
                            </div>
                        </div>
                    </div>

                    <!-- Mood Label Section -->
                    <div class="mb-4">
                        <label for="mood_label" class="form-label">
                            <i class="fas fa-tag me-2 text-info"></i>Mood Label
                        </label>
                        <input type="text" id="mood_label" name="mood_label" 
                               class="form-control form-control-lg"
                               placeholder="e.g., Happy, Anxious, Calm, Stressed, Excited">
                    </div>

                    <!-- Notes Section -->
                    <div class="mb-4">
                        <label for="notes" class="form-label">
                            <i class="fas fa-edit me-2 text-primary"></i>What's on your mind?
                        </label>
                        <textarea id="notes" name="notes" rows="4" 
                                  class="form-control"
                                  placeholder="Share your thoughts, feelings, or what happened today that might be affecting your mood..."></textarea>
                    </div>

                    <!-- Wellness Metrics -->
                    <div class="row g-4 mb-4">
                        <div class="col-md-4">
                            <div class="wellness-card text-center p-3 bg-light rounded">
                                <i class="fas fa-moon fa-2x text-info mb-2"></i>
                                <label for="sleep_hours" class="form-label small">Sleep Hours</label>
                                <input type="number" id="sleep_hours" name="sleep_hours" min="0" max="24" step="0.5"
                                       class="form-control text-center"
                                       placeholder="7.5">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="wellness-card text-center p-3 bg-light rounded">
                                <i class="fas fa-dumbbell fa-2x text-success mb-2"></i>
                                <label for="exercise_minutes" class="form-label small">Exercise (min)</label>
                                <input type="number" id="exercise_minutes" name="exercise_minutes" min="0"
                                       class="form-control text-center"
                                       placeholder="30">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="wellness-card text-center p-3 bg-light rounded">
                                <i class="fas fa-users fa-2x text-primary mb-2"></i>
                                <label for="social_interactions" class="form-label small">Social Interactions</label>
                                <input type="number" id="social_interactions" name="social_interactions" min="0"
                                       class="form-control text-center"
                                       placeholder="3">
                            </div>
                        </div>
                    </div>

                    <!-- Activities Section -->
                    <div class="mb-4">
                        <label class="form-label">
                            <i class="fas fa-list-check me-2 text-warning"></i>What did you do today?
                        </label>
                        <div class="activities-grid">
                            {% for activity in ['Work', 'Reading', 'Exercise', 'Social Media', 'Gaming', 'Cooking', 'Cleaning', 'Shopping', 'Walking', 'Meditation', 'Music', 'TV/Movies', 'Family Time', 'Friends', 'Study', 'Other'] %}
                            <div class="activity-item">
                                <input type="checkbox" id="activity_{{ loop.index }}" name="activities" value="{{ activity }}" 
                                       class="btn-check">
                                <label for="activity_{{ loop.index }}" class="btn btn-outline-primary btn-sm">
                                    <i class="fas fa-{{ 'briefcase' if activity == 'Work' else 'book' if activity == 'Reading' else 'dumbbell' if activity == 'Exercise' else 'share-alt' if activity == 'Social Media' else 'gamepad' if activity == 'Gaming' else 'utensils' if activity == 'Cooking' else 'broom' if activity == 'Cleaning' else 'shopping-cart' if activity == 'Shopping' else 'walking' if activity == 'Walking' else 'om' if activity == 'Meditation' else 'music' if activity == 'Music' else 'tv' if activity == 'TV/Movies' else 'home' if activity == 'Family Time' else 'user-friends' if activity == 'Friends' else 'graduation-cap' if activity == 'Study' else 'ellipsis-h' }} me-2"></i>
                                    {{ activity }}
                                </label>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Quick Mood Boosters -->
                    <div class="mb-4">
                        <label class="form-label">
                            <i class="fas fa-lightbulb me-2 text-warning"></i>Quick Mood Boosters
                        </label>
                        <div class="row g-2">
                            <div class="col-md-6">
                                <div class="mood-booster p-3 bg-light rounded">
                                    <h6 class="text-success mb-2">üí™ Physical</h6>
                                    <small class="text-muted">Take a walk, stretch, or do some light exercise</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mood-booster p-3 bg-light rounded">
                                    <h6 class="text-info mb-2">üßò Mental</h6>
                                    <small class="text-muted">Deep breathing, meditation, or journaling</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mood-booster p-3 bg-light rounded">
                                    <h6 class="text-primary mb-2">üë• Social</h6>
                                    <small class="text-muted">Call a friend, family member, or colleague</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mood-booster p-3 bg-light rounded">
                                    <h6 class="text-warning mb-2">üéØ Productive</h6>
                                    <small class="text-muted">Complete a small task or organize something</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Buttons -->
                    <div class="d-grid gap-3 d-md-flex justify-content-md-end">
                        <a href="{{ url_for('mood.index') }}" class="btn btn-outline-secondary btn-lg">
                            <i class="fas fa-arrow-left me-2"></i>Back to Mood History
                        </a>
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-save me-2"></i>Save Mood Entry
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Success Modal -->
<div class="modal fade" id="successModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center p-4">
                <div class="mb-3">
                    <i class="fas fa-check-circle fa-3x text-success"></i>
                </div>
                <h5 class="modal-title">Mood Entry Saved!</h5>
                <p class="text-muted">Your mood has been recorded successfully.</p>
                <div class="d-grid gap-2">
                    <button type="button" class="btn btn-primary" onclick="window.location.href='/mood/'">
                        View Mood History
                    </button>
                    <button type="button" class="btn btn-outline-primary" onclick="resetForm()">
                        Add Another Entry
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Mood slider functionality
const moodSlider = document.getElementById('mood_score');
const moodEmoji = document.getElementById('moodEmoji');
const moodLabel = document.getElementById('moodLabel');
const moodScore = document.getElementById('moodScore');

const moodData = {
    1: { emoji: 'üò¢', label: 'Very Low', color: 'text-danger' },
    2: { emoji: 'üòî', label: 'Low', color: 'text-danger' },
    3: { emoji: 'üòû', label: 'Down', color: 'text-warning' },
    4: { emoji: 'üòê', label: 'Neutral', color: 'text-warning' },
    5: { emoji: 'üòê', label: 'Neutral', color: 'text-warning' },
    6: { emoji: 'üôÇ', label: 'Good', color: 'text-info' },
    7: { emoji: 'üòä', label: 'Happy', color: 'text-info' },
    8: { emoji: 'üòÑ', label: 'Very Happy', color: 'text-success' },
    9: { emoji: 'ü§©', label: 'Excited', color: 'text-success' },
    10: { emoji: 'ü•≥', label: 'Amazing', color: 'text-success' }
};

function updateMoodDisplay(value) {
    const mood = moodData[value];
    moodEmoji.textContent = mood.emoji;
    moodLabel.textContent = mood.label;
    moodScore.textContent = `${value}/10`;
    
    // Update colors
    moodEmoji.className = `display-1 mb-2 ${mood.color}`;
    moodScore.className = `h2 ${mood.color}`;
}

moodSlider.addEventListener('input', function() {
    updateMoodDisplay(this.value);
});

// Initialize display
updateMoodDisplay(5);

// Form submission
document.getElementById('moodForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const activities = Array.from(formData.getAll('activities'));
    
    const data = {
        mood_score: parseInt(formData.get('mood_score')),
        mood_label: formData.get('mood_label'),
        notes: formData.get('notes'),
        activities: activities,
        sleep_hours: formData.get('sleep_hours') ? parseFloat(formData.get('sleep_hours')) : null,
        exercise_minutes: formData.get('exercise_minutes') ? parseInt(formData.get('exercise_minutes')) : null,
        social_interactions: formData.get('social_interactions') ? parseInt(formData.get('social_interactions')) : null
    };
    
    try {
        const response = await fetch('/mood/new', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        });
        
        if (response.ok) {
            const successModal = new bootstrap.Modal(document.getElementById('successModal'));
            successModal.show();
        } else {
            const error = await response.json();
            alert('Error: ' + error.error);
        }
    } catch (error) {
        console.error('Error:', error);
        alert('An error occurred while saving your mood entry.');
    }
});

// Reset form
function resetForm() {
    document.getElementById('moodForm').reset();
    updateMoodDisplay(5);
    const successModal = bootstrap.Modal.getInstance(document.getElementById('successModal'));
    successModal.hide();
}

// Add some interactivity to wellness cards
document.querySelectorAll('.wellness-card input').forEach(input => {
    input.addEventListener('focus', function() {
        this.parentElement.style.transform = 'scale(1.05)';
        this.parentElement.style.boxShadow = '0 4px 15px rgba(0,0,0,0.1)';
    });
    
    input.addEventListener('blur', function() {
        this.parentElement.style.transform = 'scale(1)';
        this.parentElement.style.boxShadow = 'none';
    });
});

// Add animation to activity items
document.querySelectorAll('.activity-item label').forEach(label => {
    label.addEventListener('click', function() {
        this.style.transform = 'scale(0.95)';
        setTimeout(() => {
            this.style.transform = 'scale(1)';
        }, 150);
    });
});
</script>

<style>
.mood-slider {
    height: 8px;
    border-radius: 5px;
    background: linear-gradient(to right, #dc3545 0%, #ffc107 50%, #28a745 100%);
}

.mood-slider::-webkit-slider-thumb {
    appearance: none;
    height: 24px;
    width: 24px;
    border-radius: 50%;
    background: #6366f1;
    cursor: pointer;
    border: 3px solid #ffffff;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

.mood-slider::-moz-range-thumb {
    height: 24px;
    width: 24px;
    border-radius: 50%;
    background: #6366f1;
    cursor: pointer;
    border: 3px solid #ffffff;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

.mood-display {
    transition: all 0.3s ease;
}

.wellness-card {
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.wellness-card:hover {
    border-color: #6366f1;
}

.activities-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 0.5rem;
}

.activity-item label {
    width: 100%;
    text-align: center;
    transition: all 0.2s ease;
}

.activity-item label:hover {
    transform: translateY(-2px);
}

.mood-booster {
    transition: all 0.3s ease;
    border: 1px solid transparent;
}

.mood-booster:hover {
    border-color: #6366f1;
    transform: translateY(-2px);
}

.form-control:focus {
    border-color: #6366f1;
    box-shadow: 0 0 0 0.2rem rgba(99, 102, 241, 0.25);
}

.btn-check:checked + .btn-outline-primary {
    background-color: #6366f1;
    border-color: #6366f1;
    color: white;
}

.card {
    border-radius: 15px;
}

.form-control-lg {
    border-radius: 10px;
}

.btn-lg {
    border-radius: 10px;
    padding: 12px 24px;
}
</style>
{% endblock %}
